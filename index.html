<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<title>WhatsApp Pairing</title>
<style>
  body { font-family: Arial; background:#f7f7f7; padding:20px; text-align:center; }
  .box { background:white; padding:20px; border-radius:12px; width:350px; margin:auto; box-shadow:0 2px 8px rgba(0,0,0,0.06);}
  #qr { width:250px; margin-top:15px; border-radius:8px; display:none; }
  button { background:#0070f3; color:white; padding:10px 16px; border:none; border-radius:6px; cursor:pointer; font-size:16px;}
</style>
</head>
<body>

<div class="box">
  <h2>WhatsApp Device Login QR</h2>
  <p id="st">Status: idle</p>
  <button onclick="go()">Generate QR</button><br>
  <img id="qr"/>
  <p id="done"></p>
</div>

<script>
let es;
async function go(){
  document.getElementById("st").innerText = "Status: requesting QR...";
  const r = await fetch("/api/create-session",{method:"POST"});
  const d = await r.json();
  if(es) es.close();
  es = new EventSource("/api/events/" + d.sessionId);
  es.onmessage = (m)=>{
    const x = JSON.parse(m.data);
    if(x.type==="qr"){
      document.getElementById("qr").src = x.qrDataUrl;
      document.getElementById("qr").style.display="block";
      document.getElementById("st").innerText="Status: scan QR on WhatsApp";
    }
    if(x.type==="status" && x.status==="paired"){
      document.getElementById("st").innerText="Status: âœ… paired!";
      document.getElementById("done").innerText="Session ID stored in DB: " + x.sessionDbId;
      es.close();
    }
  };
}
</script>

</body>
</html>
