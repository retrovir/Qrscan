<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<title>WhatsApp QR Pairing</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet"/>
<style>
  body{
    background:#0f172a;
    color:white;
    font-family:'Poppins',sans-serif;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    height:100vh;
    margin:0;
  }
  input{
    padding:14px;
    border:none;
    border-radius:12px;
    width:260px;
    font-size:16px;
    outline:none;
    margin-bottom:18px;
  }
  #qr{
    width:280px;
    height:280px;
    background:white;
    border-radius:22px;
    padding:18px;
    display:none;
    box-shadow:0 0 30px rgba(255,255,255,0.15);
  }
  #err{
    background:#dc2626;
    padding:12px 20px;
    border-radius:10px;
    font-size:15px;
    display:none;
    max-width:340px;
    margin-top:18px;
    text-align:center;
  }
  #status{
    margin-top:14px;
    font-size:14px;
    opacity:0.8;
  }
</style>
</head>
<body>

<input id="session" placeholder="Enter session ID (example: user123)"/>
<img id="qr"/>
<div id="err"></div>
<div id="status">Waiting for session ID...</div>

<script>
const session = document.getElementById("session");
const qrBox  = document.getElementById("qr");
const errBox = document.getElementById("err");
const status = document.getElementById("status");

session.addEventListener("change",getQR);

async function getQR(){
  if(!session.value) return;
  qrBox.style.display="none";
  errBox.style.display="none";
  status.innerText="Generating QR...";

  try{
    const r = await fetch(`/qr/${session.value}`);
    const d = await r.json();

    if(d.error){
      errBox.innerText = d.error;
      errBox.style.display="block";
      status.innerText="❌ Error received";
      return;
    }

    if(d.qr){
      qrBox.src = d.qr;
      qrBox.style.display="block";
      status.innerText="✅ Scan the QR in WhatsApp!";
    } else {
      status.innerText="No QR received yet, retry changing session ID";
    }
  }catch(e){
    errBox.innerText="❗ Frontend failed contacting server. Is backend deployed and running?";
    errBox.style.display="block";
    status.innerText="❌ Request Failed";
  }
}
</script>

</body>
</html>

